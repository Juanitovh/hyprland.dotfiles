#!/bin/bash

# hypr-theme-next: Switch to next theme in list

BUILTIN_THEMES_DIR="$HOME/.config/hypr/themes"
CUSTOM_THEMES_DIR="$HOME/.config/hypr-themes"
CURRENT_THEME_LINK="$HOME/.local/state/hyprland/current/theme"

# Collect all themes (built-in .conf files and custom directories)
THEMES=()
if [ -d "$BUILTIN_THEMES_DIR" ]; then
  while IFS= read -r theme; do
    THEMES+=("$theme")
  done < <(find "$BUILTIN_THEMES_DIR" -maxdepth 1 -type f -name "*.conf" | sort)
fi

if [ -d "$CUSTOM_THEMES_DIR" ]; then
  while IFS= read -r theme; do
    THEMES+=("$theme")
  done < <(find "$CUSTOM_THEMES_DIR" -mindepth 1 -maxdepth 1 -type d | sort)
fi

TOTAL=${#THEMES[@]}

if [ $TOTAL -eq 0 ]; then
  echo "No themes available"
  exit 1
fi

# Get current theme from symlink
if [[ -L "$CURRENT_THEME_LINK" ]]; then
  CURRENT_THEME=$(realpath "$CURRENT_THEME_LINK")
else
  # Default to first theme if no symlink exists
  CURRENT_THEME=$(realpath "${THEMES[0]}")
fi

# Find current theme index
INDEX=0
for i in "${!THEMES[@]}"; do
  THEMES[$i]=$(realpath "${THEMES[$i]}")

  if [[ "${THEMES[$i]}" == "$CURRENT_THEME" ]]; then
    INDEX=$i
    break
  fi
done

# Get next theme (wrap around)
NEXT_INDEX=$(((INDEX + 1) % TOTAL))
NEW_THEME=${THEMES[$NEXT_INDEX]}
NEW_THEME_NAME=$(basename "$NEW_THEME" .conf)

hypr-theme-set "$NEW_THEME_NAME"
