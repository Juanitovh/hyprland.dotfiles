#!/bin/bash

# hypr-drive-select: Interactive drive selector
# Usage: hypr-drive-select [drives...]

if (($# == 0)); then
  drives=$(lsblk -dpno NAME | grep -E '/dev/(sd|hd|vd|nvme|mmcblk|xv)')
else
  drives="$@"
fi

drives_with_info=""
while IFS= read -r drive; do
  [[ -n "$drive" ]] || continue
  drives_with_info+="$(hypr-drive-info "$drive")"$'\n'
done <<<"$drives"

# Use fzf if available, otherwise fall back to selection prompt
if command -v fzf &>/dev/null; then
  selected_drive="$(printf "%s" "$drives_with_info" | fzf --height=40% --header "Select drive")" || exit 1
else
  echo "Select drive:"
  select selected_drive in $drives_with_info; do
    [[ -n "$selected_drive" ]] && break
  done
fi

printf "%s\n" "$selected_drive" | awk '{print $1}'
